:: StoryTitle
æ‰˜æ‰˜é‡Œä¹‹å£¶


:: StoryData
{
  "ifid": "BA16F8EA-42F7-407F-A5EC-1FF4DA8BFD8D",
  "format": "SugarCube",
  "format-version": "2.37.3",
  "start": "åˆå§‹ä¹‹åœ°",
  "zoom": 1
}


:: PassageFooter {"position":"1200,100","size":"100,100"}
<<if ['åˆå§‹ä¹‹åœ°', 'ç‰©å“æ ', 'ç§°å·æ '].includes(passage())>>\
	<<set $footerOn to false>>\
<<else>>\
	<<set $footerOn to true>>\
<</if>>\
<<if $footerOn and $me>>\
<hr/>\
$me.name LV$me.level <<if $titles.items.length > 0>>ã€<<print $titles.items.last().name>>ã€‘<</if>>
HP :<meter @value="$me.hp" min="0" @max="$me.max_hp"></meter>
[[ç‰©å“æ ]], [[ç§°å·æ ]]
<</if>>


:: Start {"position":"1350,100","size":"100,100"}
Start
<<script>>
console.log('Start?')
<</script>>


:: StoryCaption {"position":"825,250","size":"100,100"}
$me.name LV$me.level
<<set $expNeed to $nextLevelExp()>>\
<<set _nowPassage to passage()>>\
ç»éªŒå€¼: $me.exp / $expNeed
å›ºæœ‰æ”»å‡»åŠ›: $me.intrinsicPower
å›ºæœ‰é˜²å¾¡åŠ›: $me.intrinsicResistance
è¡€é‡: $me.hp / $me.max_hp
æ­¦å™¨: <<link $me.weapon.name>><<set $temp to $showWeapon()>><</link>>(æ”»å‡»åŠ›: $me.weapon.power)
é˜²å…·: <<link $me.armor.name>><<set $temp to $showArmor()>><</link>> (é˜²å¾¡åŠ›:  $me.armor.resistance)
<<if $me.ring>>æŒ‡ç¯ï¼š$me.ring.name <<link "å¸ä¸‹" _nowPassage>><<set $me.ring to null>><</link>><</if>>


:: ä¸€æœ¬ç¿»å¼€çš„ä¹¦ {"position":"525,250","size":"100,100"}
ä»”ç»†ä¸€çœ‹ï¼Œè¿™ä¸æ˜¯ä¸€æœ¬ä¹¦ï¼Œè€Œæ˜¯è‡ªå·±å†™ä¸‹çš„ç¬”è®°ã€‚

æœ€ä¸Šé¢çš„ä¸€é¡µå†™ç€ï¼š

æ˜å¤©å°±æ˜¯æˆ‘çš„åå…­å²ç”Ÿæ—¥äº†ã€‚
ä»æ˜å¤©å¼€å§‹ï¼Œæˆ‘å°±è¦ç¦»å¼€è¿™ä¸ªå®¶ï¼Œè¸ä¸Šç‹¬è‡ªä¸€äººçš„æ—…ç¨‹ã€‚
æˆ‘æ²¡æœ‰è¿‡å»çš„è®°å¿†ã€‚
è€å¤´ä¹Ÿä¸å‘æˆ‘é€éœ²ä»»ä½•ä¸œè¥¿ã€‚
ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªé˜´è°‹ï¼Œä½†æ˜¯ç°åœ¨çš„æˆ‘ä¸å¾—è€ŒçŸ¥ã€‚
å¸Œæœ›æ–°çš„æ—…ç¨‹èƒ½å¤Ÿç»™æˆ‘ç­”æ¡ˆâ€¦â€¦

[[è¿”å›->èµ·å±…å®¤]]


:: ä¸‹ä¸€é¡µ {"position":"850,575","size":"100,100"}
ğŸ–•

æˆ‘è¿˜æƒ³ä½ æ¥å‘Šè¯‰æˆ‘æˆ‘çš„èº«ä¸–å‘¢ï¼Œä½ è¿™ä¸ªBYDä¸å­ç©æ„ã€‚

[[è€å¤´çš„æˆ¿é—´]]

<<script>>
State.variables.oldManLetterRead = true
<</script>>


:: äº¤å‡º5ä¸ªå²è±å§†ç²˜æ¶² {"position":"425,375","size":"100,100"}
<<script>>
let itemName =  'å²è±å§†ç²˜æ¶²'
reduceItemCount(State.variables.inventory.items, itemName, 5)
State.variables.temp = getItem(State.variables.inventory.items, itemName)
addItem(State.variables.inventory.items, State.variables.clownMask, 1)
<</script>>
æŠŠ5ä¸ªå²è±å§†ç²˜æ¶²ç»™äº†è€å¤´ï¼Œç°åœ¨åªå‰©ä¸‹$temp.countä¸ªäº†ã€‚
ä¸è¿‡ä¹Ÿæ²¡ä»€ä¹ˆå¥½å¯æƒœçš„ã€‚

ä½œä¸ºå›æŠ¥ï¼Œè€å¤´ç»™äº†ä½ ä¸€ä¸ªå°ä¸‘é¢å…·ã€‚

[[è¿”å›->å‘è€å¤´æ­è¯]]


:: ä¼‘æ¯ {"position":"525,125","size":"100,100"}
ç»è¿‡å‰§çƒˆçš„ä¼‘æ¯ï¼Œä½“åŠ›æ¢å¤äº†ï¼
<<set $me.hp to $me.max_hp>>\

<<return "è¿”å›">>


:: ä½çŸ®æ—åœ° {"position":"575,525","size":"100,100"}
=ä½çŸ®æ—åœ°=
<<set $slime.hp to $slime.max_hp>>\

å±‹å­æ—è¾¹çš„å°æ ‘æ—ã€‚
è¿™é‡Œç”Ÿæ´»ç€å¾ˆå¤šå¼±å°çš„é­”ç‰©ã€‚
ç›®åŠ›æ‰€åŠçš„åœ°æ–¹å°±æœ‰å¾ˆå¤šå²è±å§†ã€‚\
<<link "æ”»å‡»å²è±å§†" "æˆ˜æ–—ç”»é¢">>
	<<set $lastPassage to 'ä½çŸ®æ—åœ°'>>\
    <<set $enemyVarName to 'slime'>>\
<</link>>\


[[å›å®¶->å¤§å…]]


:: ä½ èƒ½ä¸èƒ½å…ˆä»é‚£é‡Œå‡ºæ¥ {"position":"475,1025","size":"100,100"}
â€œæˆ‘ä¹Ÿæƒ³å‡ºæ¥ï¼Œå¯è¿™ä¸œè¥¿ä¸æ”¯æŒå¤ªç»†å¾®çš„è°ƒèŠ‚ï¼Œè€Œä¸”æˆ‘äººå…¶å®ä¸åœ¨è¿™é‡Œï¼Œæƒ³ç€è‡³å°‘ç”¨çœ¼ç›çœ‹ä¸€ä¸‹éƒ½å¥½ï¼Œååå¡åœ¨è¿™ç§åœ°æ–¹â€¦â€¦å”‰å’Œä½ è§£é‡Šé‚£ä¹ˆå¤šä¹Ÿæ²¡æœ‰ç”¨ï¼Œä½ èƒ½ä¸èƒ½å‘Šè¯‰æˆ‘è¿™é‡Œæ˜¯å“ªé‡Œï¼Ÿâ€
â€œæ–¹ä½ä¸Šåº”è¯¥æ˜¯<span class='important'>åº•é‡Œæ–¯ç‹å›½çš„ä¸œå—</span>ã€‚â€
â€œå“¦ï¼å±…ç„¶æ¥åˆ°è¿™ç§åœ°æ–¹äº†å—ã€‚â€
â€œä½ è¿™ç§æƒ…å†µç©¶ç«Ÿæ˜¯æ€ä¹ˆå›äº‹ï¼Ÿâ€
â€œå”‰æˆ‘ä¸€æ—¶åŠä¼šç»™ä½ è§£é‡Šä¸æ¸…æ¥šï¼Œå¿«åˆ°æ—¶é—´äº†ï¼Œä½ æœ‰æœºä¼šçš„è¯åˆ°å¸ƒé‡Œæ–¯å¦ç‹å›½æ¥æ‰¾æˆ‘ï¼Œå°±è¯´æ˜¯æ‰¾<span class='important'>å¤©æ‰ç§‘å­¦å®¶å¢æ©</span>åˆ«äººå°±æ‡‚äº†ã€‚åˆ°æ—¶å€™æˆ‘å†å‘ä½ è§£é‡Šã€‚â€
çœ¼çœ‹ç€é‚£äººçš„è…¿ä¸Šå‡ºç°äº†ä¸€äº›äº®ç»¿è‰²çš„å™ªç‚¹ï¼Œè¿™è¿‡åˆ†è¯¡å¼‚çš„å…‰æ™¯è®©$me.nameæ„Ÿåˆ°æ¯›éª¨æ‚šç„¶ã€‚

"é‡è§å¯ä»¥äº¤æµçš„äººçœŸæ˜¯ä¸å¯æ€è®®ï¼Œè¿˜å¥½åº•é‡Œæ–¯å’Œå¸ƒé‡Œæ–¯å¦æ˜¯ç”¨åŒæ ·è¯­è¨€çš„å›½å®¶ï¼Œå¦‚æœæ˜¯æ›´è¿œæˆ–è€…æ˜¯æŸäº›å¤æ€ªçš„åœ°æ–¹å°±éš¾è¯´äº†ã€‚â€œ
è¿™è¿˜ä¸ç®—æ˜¯å¤æ€ªçš„åœ°æ–¹å—ã€‚
â€ä½ è¯´ä½ åœ¨å“¥å¸ƒæ—å·¢ç©´ï¼Œé‚£ä½ åº”è¯¥æ˜¯å†’é™©è€…å¯¹å§ã€‚æˆ‘å¾…ä¼šç»™ä½ <span class='important'>ä¼ é€ä¸ªä¸œè¥¿è¿‡æ¥</span>ï¼Œå¸Œæœ›èƒ½å¯¹ä½ çš„å†’é™©æœ‰å¸®åŠ©ã€‚çœŸå¿ƒç¥æ„¿æˆ‘ä»¬æœ‰ç¼˜å†è§ã€‚æ²¡æ—¶é—´äº†ï¼Œå°±"
è¯éŸ³æˆ›ç„¶è€Œæ­¢ï¼Œéšä¹‹æ¶ˆå¤±çš„æ˜¯ç”·äººçš„åŠèº«ï¼Œåªç•™ä¸‹äº†å’Œå¾€å¸¸ä¸€æ ·çš„å²©é¢ã€‚

[[ç‰‡åˆ»ä¹‹å]]


:: åˆå§‹ä¹‹åœ° {"position":"700,100","size":"100,100"}
<<set $default_weapon to {name: 'ç©ºæ‰‹', power: 1, desc: 'æ‹³å¤´å°±æ˜¯æœ€å¥½çš„æ­¦å™¨ã€‚'}>>\
<<set $default_armor to {name: 'è¿åŠ¨æœ', resistance: 1, desc: 'å±…å®¶ç”¨ã€‚'}>>\
<<set $me to {name: 'ä½ çˆ¹', hp: 100, max_hp: 100, weapon: $default_weapon, armor: $default_armor, intrinsicPower: 0, intrinsicResistance: 0, level: 1, exp: 0}>>\
æˆ‘çš„åå­—å«ä½œï¼š
<<textbox "$me.name" "çˆ¶äº²">>

[[è¿›å…¥æ¸¸æˆ->èµ·å±…å®¤]]


<<set $inventory to {desc: 'ç‰©å“æ ', items: []}>>
<<set $titles to {desc: 'ç§°å·', items: []}>>

<<set $beginnerWeaponGot to false>>
<<set $beginnerWeapon to {name: 'æœ¨å‰‘', power: 2, desc: 'å¹³å‡¡çš„æœ¨å‰‘ã€‚'}>>
<<set $beginnerArmor to {name: 'é¹¿çš®å¤¹å…‹', resistance: 2, desc: 'éšå¤„å¯è§çš„é¹¿çš®å¤¹å…‹ã€‚'}>>
<<set $bloodedIronSword to {name: 'æŸ“è¡€çš„é“å‰‘', power: 5, desc: 'ç”±äºè¡€æ±¡å˜é’äº†ä¸€äº›ã€‚'}>>
<<set $bloodedDeerskinArmor to {name: 'æŸ“è¡€çš„é¹¿çš®å¤¹å…‹', resistance: 4, desc: 'æ•£å‘ç€ä»¤äººæ¶å¿ƒçš„è…¥è‡­ã€‚'}>>

<<set $footerOn to true>>

/* NPC & Monsters */
<<script>>
console.log('HELLO?')
State.variables.slimeDrop =  {name: 'å²è±å§†ç²˜æ¶²', desc: 'å²è±å§†æ‰è½çš„ç²˜ç¨ æ¶²ä½“ï¼Œåº”è¯¥ä¸ä¼šæœ‰äººéœ€è¦å§ï¼Ÿ'};
State.variables.mountainGoblinSoul =  {name: 'å±±å²­å“¥å¸ƒæ—çš„çµé­‚', desc: 'å±±å²­å“¥å¸ƒæ—çš„åšéŸ§çµé­‚ã€‚'};
State.variables.normalGoblinSoul =  {name: 'æˆå¹´å“¥å¸ƒæ—çš„çµé­‚', desc: 'æˆå¹´å“¥å¸ƒæ—çš„å‘å¾®çµé­‚ã€‚'};
State.variables.oldMan = {name: 'è€å¤´', max_hp: 100, hp: 100, power: 5, resistance: 2, exp: 100};
State.variables.slime = {
	name: 'å²è±å§†', 
    exp: 3,
    max_hp: 10,
    hp: 10, 
    power: 1, 
    resistance: 1, 
    drops: [{
    	item: State.variables.slimeDrop, 
        chance: 0.6
    }]
}
State.variables.mountainGoblin = {
	name: 'å±±å²­å“¥å¸ƒæ—', 
    exp: 150,
    max_hp: 120,
    hp: 120, 
    power: 10, 
    resistance: 16, 
    drops: [{
    	item: State.variables.mountainGoblinSoul, 
        chance: 1.0
    }]
}
State.variables.theOutpostMountainGoblin = structuredClone(State.variables.mountainGoblin);
State.variables.normalGoblin = {
	name: 'æˆå¹´å“¥å¸ƒæ—', 
    exp: 60,
    max_hp: 60,
    hp: 60, 
    power: 9, 
    resistance: 6, 
    drops: [{
    	item: State.variables.normalGoblinSoul, 
        chance: 0.4
    }]
}
State.variables.clownMask = {
	name: 'å°ä¸‘é¢å…·',  desc: 'çœ‹èµ·æ¥æœ‰äº›è¯¡å¼‚çš„é¢å…·ï¼Œèƒ½å¤Ÿå“å“­å°å­©ã€‚'
}
State.variables.oldManSlayer = {
	name: 'å¼‘äº²è€…',  desc: 'åªæ˜¯æ€æ­»äº†ä¸ªè€å¤´è€Œå·²ï¼Œæœ‰ä»€ä¹ˆå¥½å¤§æƒŠå°æ€ªçš„ã€‚'
}
State.variables.slimeSlayer = {
	name: 'å²è±å§†æ€æ‰‹',  desc: 'æœ€å¥½ä¸è¦è®©åŠ¨ç‰©ä¿æŠ¤åä¼šçŸ¥é“ã€‚'
}
State.variables.goblinSlayer = {
	name: 'æŠ¤ç”²å‡»ç ´è€…',  desc: 'ç¬¬ä¸€æ¬¡å‡»è´¥å±±å²­å“¥å¸ƒæ—ã€‚'
}
State.variables.healMySelf = function healMySelf(percentage){
	healing(State.variables.me, percentage);
}
State.variables.useSmallHealingPotion = function useSmallHealingPotion(){
	healing(State.variables.me, 0.2);
    reduceItemCount(State.variables.inventory.items, 'å°å›å¤ç“¶');
}
State.variables.smallHealingPotion = {
	name: 'å°å›å¤ç“¶',  desc: 'å›å¤20%HPã€‚', useCallback: State.variables.useSmallHealingPotion
}
// å¢åŠ ç»éªŒ
State.variables.levelUpMe = function levelUpMe(){
	window.levelUp(State.variables.me)
}
State.variables.addExp = function  addExp(exp){
	console.log('è·å–äº†' + exp + 'ç‚¹ç»éªŒ')
	let {newExp, newLevel, levelsGained} = expGot(State.variables.me.exp, exp, State.variables.me.level, State.variables.levelUpMe);
    console.log('newExp ' + exp + 'ç‚¹ç»éªŒ')
    State.variables.me.exp = newExp;
}
State.variables.nextLevelExp = function(){
	return expCurve(State.variables.me.level);
}
State.variables.showDialog = function(title, text){
    Dialog.create(title);
    Dialog.wiki(text);
    Dialog.open();
}
State.variables.showDialogWithTextList = function(title, textList){
    Dialog.create(title);
	let text = textList.join('\n');; // è¯·å¸®æˆ‘è¡¥å……è¿™ä¸€è¡Œï¼Œä½¿ç”¨æ¢è¡Œç¬¦æ¥æ¢è¡Œå³å¯
    Dialog.wiki(text);
    Dialog.open();
}
State.variables.showWeapon = function(){
	let title = State.variables.me.weapon.name
    let desc = State.variables.me.weapon.desc
	State.variables.showDialog(title, desc)
}
State.variables.showArmor = function(){
	let title = State.variables.me.armor.name
    let desc = State.variables.me.armor.desc
	State.variables.showDialog(title, desc)
}
State.variables.armorPiercingRingFightCb = function (obj1, obj2){
	console.log('ç ´ç”²æŒ‡ç¯æ›´æ”¹' + obj2.name + 'çš„é˜²å¾¡å€¼,å°†å…¶ä¿®æ”¹ä¸º0')
	obj2.resistance = 0;
	return 'ç ´ç”²æŒ‡ç¯ç”Ÿæ•ˆäº†ï¼Œå°†æ— è§†æ•Œäººé˜²å¾¡è¿›è¡Œæ”»å‡»ï¼'
}
State.variables.armorPiercingRingUseCb = function(){
	State.variables.me.ring = State.variables.armorPiercingRing;
    State.variables.showDialog('è£…å¤‡æŒ‡ç¯', 'æˆåŠŸè£…å¤‡äº†ç ´ç”²æŒ‡ç¯!');
}
State.variables.armorPiercingRing = {name: 'ç ´ç”²æŒ‡ç¯', desc: 'æŒ‡ç¯çš„æ°´æ™¶é‡Œå°å­˜ç€ä¸€å°ç‰‡éª¨å¤´ã€‚', fightCallback: State.variables.armorPiercingRingFightCb, fightMessage: 'ç ´ç”²æŒ‡ç¯å°†æ•Œäººçš„é˜²å¾¡é™ä¸º0ç‚¹ã€‚', useCallback: State.variables.armorPiercingRingUseCb}
// State.variables.me.ring = State.variables.armorPiercingRing;
State.variables.globalUseCallback = function(idx){
	console.log('globalUseCallback ' + idx);
    console.log('I am going to call ' + State.variables.inventory.items[idx].name + ' callback');
    State.variables.inventory.items[idx].useCallback()
}
State.variables.showDialogFightHistory = function(){
	State.variables.showDialogWithTextList('æˆ˜æ–—è®°å½•', State.variables.fightHistory)
}
console.log('I am done')
<</script>>

<<script>>
    window.dd = State.variables
<</script>>


:: å‘ç©¿å¢™è€…æ­è¯ {"position":"475,900","size":"100,100"}
é‚£æ˜¯ååˆ†è¯¡å¼‚çš„å…‰æ™¯ï¼Œé‚£äººç›´ç›´ç«™ç€ï¼Œä¸ŠåŠèº«å®Œå…¨æ²¡å…¥äº†å²©å±‚ä¹‹ä¸­ã€‚
æˆ–è€…è¯´ï¼Œåƒæ˜¯ä»å²©çŸ³ä¸­é•¿å‡ºæ¥ä¸¤æ¡è…¿ä¸€æ ·ã€‚

å‘å‡ºå£°éŸ³ï¼Œè¯•å›¾å¸å¼•é‚£ä¸ªä¸œè¥¿çš„æ³¨æ„ã€‚
â€œä½ ï¼Œä½ å¥½â€¦â€¦â€<span class='good'>$me.name</span>è¯´ã€‚

â€œæœ‰äººåœ¨é‚£é‡Œï¼Ÿâ€é‚£ä¸ªä¸œè¥¿ç”¨ä¸€ä¸ªç”·äººçš„å£°éŸ³å›è¯äº†ã€‚
â€œå¯¹ã€‚â€
â€œä½ èƒ½å‘Šè¯‰æˆ‘è¿™é‡Œæ˜¯ä»€ä¹ˆåœ°æ–¹å—ï¼Ÿâ€
â€œåº”è¯¥æ˜¯å“¥å¸ƒæ—çš„å·¢ç©´ã€‚â€
æ²‰é»˜äº†ä¸€ä¼šå„¿ã€‚
â€œå“ªä¸ªå›½å®¶çš„å“ªä¸ªæ–¹ä½ï¼Ÿâ€ç”·äººé—®é“ã€‚

â€œ[[ä½ èƒ½ä¸èƒ½å…ˆä»é‚£é‡Œå‡ºæ¥]]ï¼Ÿâ€


:: å‘è€å¤´æ­è¯ {"position":"550,375","size":"100,100"}
è€å¤´ï¼šä»Šå¤©æ˜¯ä½ çš„åå…­å²ç”Ÿæ—¥ã€‚ä»ä»Šå¤©å¼€å§‹ï¼Œ<span class='good'>$me.name</span>ï¼Œä½ å°†è¦å¼€å§‹ç‹¬è‡ªçš„å†’é™©ç”Ÿæ´»ã€‚

è€å¤´ï¼šç°åœ¨ï¼Œæˆ‘æœ‰ä¸€ä¸ªä»»åŠ¡äº¤ç»™ä½ ï¼Œå»<span class='important'>æ€æ­»5åªå²è±å§†ï¼Œå¸¦å›å®ƒä»¬æ‰è½çš„ç²˜æ¶²</span>ï¼Œå‘æˆ‘è¯æ˜ä½ çš„èƒ½åŠ›ã€‚

è€å¤´ï¼šå²è±å§†ç»å¸¸åœ¨å±‹å¤–çš„<span class='important'>ä½çŸ®æ—åœ°</span>å‡ºæ²¡ã€‚ä½ éœ€è¦å…ˆå‡ºå»å±‹å¤–ï¼Œæ‰èƒ½å‰å¾€ä½çŸ®æ—åœ°ã€‚
\
<<silently>>\
<<script>>
let hasSlimeDrop = checkHavingItem(State.variables.inventory.items, 'å²è±å§†ç²˜æ¶²')
State.variables.hasSlimeDrop = hasSlimeDrop
if(hasSlimeDrop){
	State.variables.temp = getItem(State.variables.inventory.items, 'å²è±å§†ç²˜æ¶²')
}
<</script>>
<</silently>>\
\
<<if $hasSlimeDrop>>
è€å¤´ï¼š ä½ ç°åœ¨æ‹¥æœ‰$temp.countä¸ªå²è±å§†ç²˜æ¶²ã€‚
	<<if $temp.count >= 5>>
    	ğŸŸ¢[[äº¤å‡º5ä¸ªå²è±å§†ç²˜æ¶²]]
	<</if>>
<<else>>
è€å¤´ï¼š ä½ è¿˜æ²¡æœ‰æ‹¿åˆ°å²è±å§†ç²˜æ¶²ã€‚
<</if>>

[[è¿”å›->å¤§å…]]


:: å“¥å¸ƒæ—å‰å“¨ç«™ {"position":"725,900","size":"100,100"}
=å“¥å¸ƒæ—å‰å“¨ç«™=

ä¸€ä¸ªé»‘ä¹ä¹çš„æ´å£é€šå¾€å·¢ç©´æ·±å¤„ã€‚

æ´å£å¤–è¾¹ç¨å¾®å¼€é˜”ä¸€ç‚¹çš„åœ°æ–¹ï¼Œ\
<<if $theOutpostMountainGoblin.hp > 0>>\
ä¸€åªæ‹¿ç€ç«æŠŠçš„å¤§å—å¤´å“¥å¸ƒæ—åœ¨å·¡é€»ã€‚<<link "æ”»å‡»å¤§ä¸ªå­å“¥å¸ƒæ—" "æˆ˜æ–—ç”»é¢">>
	<<set $lastPassage to 'å“¥å¸ƒæ—å‰å“¨ç«™'>>\
    <<set $enemyVarName to 'theOutpostMountainGoblin'>>\
<</link>>\
<<else>>\
èººç€å¤§å—å¤´å“¥å¸ƒæ—çš„å°¸ä½“ã€‚
ğŸŸ¢ç°åœ¨æˆ‘å¯ä»¥å‰å¾€[[å·¢ç©´æ·±å¤„]]ã€‚
<</if>>\


åœ°ä¸Šèººç€æ­»å»çš„åŒä¼´ä»¬çš„å°¸ä½“ã€‚
ä»”ç»†çœ‹çš„è¯èƒ½å¤Ÿå‘ç°ï¼Œ[[æ¢…åˆ©çš„å°¸ä½“åœ¨å‘å…‰]]ã€‚

[[èº²è¿›å²©çŸ³è£‚ç¼->å“¥å¸ƒæ—å·¢ç©´è£‚ç¼]]


:: å“¥å¸ƒæ—å·¢ç©´è£‚ç¼ {"position":"600,775","size":"100,100"}
=ç‹­çª„çš„å²©çŸ³è£‚ç¼=

æ˜æš—çš„æ´ç©´ï¼Œç©ºæ°”ä¸­æ¼‚æµ®ç€è…è‚‰å’Œç²ªä¾¿çš„å‘³é“ã€‚

<<if not $consideredInCave>>
[[æ€è€ƒæˆ‘ç°åœ¨åº”è¯¥åšçš„äº‹æƒ…]]
<<else>>
ğŸŸ¢å‰å¾€[[å“¥å¸ƒæ—å‰å“¨ç«™]]ã€‚
<<if $meetWallPenetrater is false and random(100) < 100>>
ğŸŸ ã€éšæœºäº‹ä»¶ã€‘
å¦‚æœæˆ‘æ²¡çœ‹é”™çš„è¯ï¼Œå²©çŸ³é‡Œé¢é•¿å‡ºæ¥ä¸€ä¸ªäººã€‚[[å‘ä»–æ­è¯->å‘ç©¿å¢™è€…æ­è¯]]
<</if>>
<</if>>


:: å¤§å… {"position":"700,375","size":"100,100"}
=å¤§å…=

è€æ—§æœ¨å¤´æˆ¿å­çš„å®¢å…ã€‚
ä»è¿™é‡Œå¯ä»¥å‰å¾€[[å°å±‹å‰åå­—è·¯å£]]ï¼Œ[[èµ·å±…å®¤]]å’Œ[[è€å¤´çš„æˆ¿é—´]]ã€‚

å¦‚æœæƒ³è¦ä¼‘æ¯çš„è¯ï¼Œæˆ‘éœ€è¦å…ˆè¿”å›èµ·å±…å®¤ã€‚

<<if $oldMan.hp > 0>>
å®¢å…ä¸­å¤®ç«™ç€ä¸€ä¸ª$oldMan.nameã€‚\
<<link "æ”»å‡»" "æˆ˜æ–—ç”»é¢">>
	<<set $lastPassage to 'å¤§å…'>>\
    <<set $enemyVarName to 'oldMan'>>
<</link>>
[[å‘è€å¤´æ­è¯]]
<<else>>
å®¢å…ä¸­å¤®èººç€$oldMan.nameçš„å°¸ä½“ã€‚
ğŸŸ¢ç°åœ¨ï¼Œæˆ‘å¯ä»¥ä»å°å±‹å‰é¢çš„åå­—è·¯å£ç¦»å¼€ã€‚
<</if>>


:: å°å±‹å‰åå­—è·¯å£ {"position":"725,525","size":"100,100"}
=å°å±‹å‰åå­—è·¯å£=

ä»è¿™é‡Œå¯ä»¥çœ‹è§ç ´çƒ‚çš„[[å°å±‹->å¤§å…]]ï¼Œå’Œå°å±‹èƒŒåçš„[[ä½çŸ®æ—åœ°]]ã€‚

å¤§é©¬è·¯å¦‚æ­¤ç¬”ç›´ï¼Œå®ƒä¸€å®šå¯ä»¥å¸¦æˆ‘å»å¾€ä»»ä½•åœ°æ–¹ã€‚

<<if $oldMan.hp < 1>>
ğŸŸ¢æ˜¯æ—¶å€™[[ç¦»å¼€è¿™é‡Œ]]äº†ã€‚
<</if>>


:: å·¢ç©´æ·±å¤„ {"position":"900,900","size":"100,100"}
<<set $normalGoblin.hp to $normalGoblin.max_hp>>\
=<<print passage()>>=

å“¥å¸ƒæ—å·¢ç©´æ·±å¤„ï¼Œè«åçš„è…è‡­æ›´åŠ ä¸¥é‡äº†ã€‚

åœ¨é»‘æš—çš„æ©ç›–ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥<<link "æ”»å‡»å“¥å¸ƒæ—" "æˆ˜æ–—ç”»é¢">>
	<<set $lastPassage to 'å·¢ç©´æ·±å¤„'>>\
    <<set $enemyVarName to 'normalGoblin'>>\
<</link>>æ”»å‡»å“¥å¸ƒæ—è€Œä¸ä¼šå¼•èµ·éªšä¹±ã€‚

ä»è¿™é‡Œå¯ä»¥å‰å¾€[[ç¥­å›]]ï¼Œ[[ç‹ä¹‹é—´]]ã€‚
æˆ–è€…è¿”å›[[å“¥å¸ƒæ—å‰å“¨ç«™]]ã€‚


:: æ€è€ƒæˆ‘ç°åœ¨åº”è¯¥åšçš„äº‹æƒ… {"position":"600,900","size":"100,100"}
é€‰æ‹©æ°¸è¿œåªæœ‰ä¸¤ç§ï¼Œå‰è¿›ï¼Œæˆ–è€…æ˜¯åé€€ã€‚

å¦‚ä»Šä»˜å‡ºäº†æƒ¨é‡çš„ä»£ä»·ï¼Œæˆ‘å·²ç»å¤±å»äº†åé€€çš„é€‰é¡¹ã€‚
æˆ‘å¿…é¡»å–ä¸‹å“¥å¸ƒæ—ç‹çš„å¤´é¢…ï¼Œä»¥æ­¤å‡­åŠæ­»å»çš„é˜Ÿå‹ä»¬ã€‚

[[è¿”å›->å“¥å¸ƒæ—å·¢ç©´è£‚ç¼]]
<<script>>
State.variables.consideredInCave = true;
<</script>>


:: æˆ˜æ–—ç”»é¢ {"position":"1000,225","size":"100,100"}
=æˆ˜æ–—=
<<silently>>\
<<script>>
if (State.variables[State.variables.enemyVarName].hp < 1){
	console.log('Should not fight against dead body');
    State.variables.error = true;
}else{
	State.variables.error = 0;
	// å¤„ç†ä¸»è§’çš„powerå’Œresistance
	const me = State.variables.me;
	me.power = me.intrinsicPower + me.weapon.power;
	me.resistance = me.intrinsicResistance + me.armor.resistance;
	const meCopy = fightObjectCopy(me);
	// æµ‹è¯•ç”¨ä»£ç 
	console.log(State.variables.enemyVarName);
	console.log(State.variables[State.variables.enemyVarName]);
	console.log(State.variables.me);
	// å¤„ç†æ•Œäººçš„objCopy
	const enemy = State.variables[State.variables.enemyVarName];
	const enemyCopy = fightObjectCopy(enemy);
	// 2024.10.21 å¢åŠ æŒ‡ç¯æ•ˆæœ
	const beforeFightCallbacks = []
	if (State.variables.me.ring && State.variables.me.ring.fightCallback){
		beforeFightCallbacks.push(State.variables.me.ring.fightCallback);
	}
	let fightHistory = fight(meCopy, enemyCopy, beforeFightCallbacks);
	State.variables.fightHistory = fightHistory; // ç”¨äºåç»­å±•ç¤ºè®°å½•
	window.temp = fightHistory;
	// console.log(fightHistory);
	State.variables.me.hp = meCopy.hp;
	State.variables[State.variables.enemyVarName].hp = enemyCopy.hp;
	State.variables.enemy = State.variables[State.variables.enemyVarName]; 
}
<</script>>
<</silently>>\

<<if $error>>\
	$enemy.nameå·²ç»æ­»äº†ï¼Œè¯·ä¸è¦åå¤é­å°¸ï¼
<<else>>\
å‘$enemy.nameå‘èµ·äº†æ”»å‡»ï¼
<<if $me.hp < 1>>\
<<goto "æ­»äº¡">>\
<<else>>\
<span class='good'>$enemy.nameè¢«ä½ æ€æ­»äº†ï¼</span>
<<include 'ç‰©å“æ‰è½'>>
<<include 'æ€æ­»æ€ªç‰©å›è°ƒ'>>
<<button "æŸ¥çœ‹æˆ˜æ–—è®°å½•">><<set _temp to $showDialogFightHistory()>><</button>>
<</if>>\
<</if>>\

<<link "è¿”å›" $lastPassage>><</link>>


:: æ€æ­»æ€ªç‰©å›è°ƒ {"position":"1250,425","size":"100,100"}
<<silently>>\
<<script>>
State.variables.addExp(State.variables.enemy.exp);
if (State.variables.enemy.name == 'å²è±å§†'){
	console.log('æ€æ­»å²è±å§†')
	addItem(State.variables.titles.items, State.variables.slimeSlayer, 1)
}else if (State.variables.enemy.name == 'è€å¤´'){
	console.log('æ€æ­»è€å¤´')
	if (!checkHavingItem(State.variables.titles.items, 'å¼‘äº²è€…')){
    	addItem(State.variables.titles.items, State.variables.oldManSlayer)
    }
}else if (State.variables.enemyVarName == 'theOutpostMountainGoblin'){
	if (!State.variables.me.ring || State.variables.me.ring.name != 'ç ´ç”²æŒ‡ç¯'){
    	console.log('ä¸ä½¿ç”¨ç ´ç”²æˆ’æŒ‡å‡»ç ´å±±å²­å“¥å¸ƒæ—');
        const title = {name: 'æ‰‹æ’•é‡å¦è€…', desc: 'ä¸ä½¿ç”¨ç ´ç”²æˆ’æŒ‡å‡»ç ´å‰å“¨ç«™çš„å±±å²­å“¥å¸ƒæ—ã€‚'}
        addItem(State.variables.titles.items, title)
    }else{
    	const title = {name: 'å°å¼Šè€…', desc: 'ä½¿ç”¨ç ´ç”²æˆ’æŒ‡å‡»ç ´å‰å“¨ç«™çš„å±±å²­å“¥å¸ƒæ—ã€‚'}
        addItem(State.variables.titles.items, title);
    }
	console.log('æ€æ­»å‰å“¨ç«™çš„å±±å²­å“¥å¸ƒæ—');
}
<</script>>
<</silently>>\


:: æ¢…åˆ©çš„å°¸ä½“åœ¨å‘å…‰ {"position":"725,1025","size":"100,100"}
æ¢…åˆ©æ˜¯æˆ‘ä»¬é˜Ÿä¼ä¸­çš„ç‰§å¸ˆã€‚
å¥¹ç»™è‡ªå·±æ–½åŠ äº†è¯…å’’ï¼Œä¸€æ—¦æ­»äº¡å°±ä¼šè¿‘ä¹æ°¸ä¹…åœ°ä¸ºå››å‘¨æ–½åŠ æ²»ç–—å…‰ç¯ã€‚
å¦‚æœç¨å¾®é è¿‘å°±èƒ½å¤Ÿå›å¤å¥åº·ã€‚

<<link "ä½¿ç”¨æ¢…åˆ©è¿›è¡Œæ²»ç–—" "æ¢…åˆ©çš„å°¸ä½“åœ¨å‘å…‰">><<set $temp to $healMySelf(0.05)>><</link>>
[[è¿”å›->å“¥å¸ƒæ—å‰å“¨ç«™]]


:: æ­»äº¡ {"position":"1125,250","size":"100,100"}
=æ­»äº¡=

<span class='danger'>ä½ è¢«$enemy.nameæ€æ­»äº†ï¼</span>
$enemy.nameçš„HPå‰©ä½™$enemy.hpç‚¹ï¼Œä¸‹æ¬¡å†åŠªåŠ›å§ã€‚

<<button "æŸ¥çœ‹æˆ˜æ–—è®°å½•">><<set _temp to $showDialogFightHistory()>><</button>>

ç‚¹å‡»ä¾§è¾¹æ çš„"RESTART"é‡æ–°å¼€å§‹æ¸¸æˆã€‚


:: ç‰‡åˆ»ä¹‹å {"position":"475,1150","size":"100,100"}
ç¨è¿‡ç‰‡åˆ»ï¼Œä¼ æ¥äº†å°å°çš„å½“å•·å£°ï¼Œå¥½åƒæœ‰ä»€ä¹ˆä¸œè¥¿æ‰åœ¨äº†åœ°ä¸Šã€‚
éš¾é“è¯´æ˜¯åˆšåˆšé‚£äººè¯´çš„ä¸œè¥¿å—ï¼Ÿ

åœ¨åœ°ä¸Šæ‘¸ç´¢äº†ä¸€ä¸‹ï¼Œ<span class='good'>æ‰¾åˆ°äº†ä¸€æšæŒ‡ç¯</span>ã€‚

[[è¿”å›->å“¥å¸ƒæ—å·¢ç©´è£‚ç¼]]
<<silently>>\
<<script>>
	addItem(State.variables.inventory.items, State.variables.armorPiercingRing);
    State.variables.meetWallPenetrater = true;
<</script>>
<</silently>>\


:: ç‰©å“æ‰è½ {"position":"1125,375","size":"100,100"}
<<silently>>\
<<script>>
State.variables.temp = 'è«åå¥‡å¦™çš„å­—ç¬¦ä¸²';
State.variables.temp2 = [];
let enemy = State.variables.enemy;
if ('drops' in enemy){
	let items = dropItems(enemy.drops)
    console.log(items)
    let text = dropString(items)
    State.variables.temp = text
    State.variables.temp2 = items
    if (items.length > 0){
    	addToInventory(State.variables.inventory.items, items)
    }
}else {
    console.log('no drops')
    State.variables.temp = []
}
<</script>>
<</silently>>
<<if $temp2.length > 0>>\
	<span class='good'>$enemy.nameæ‰è½äº†$tempã€‚</span>
<</if>>\


:: ç‰©å“æ  {"position":"875,100","size":"100,100"}
<<for _i, _item range  $inventory.items>>
	<<if _item.count > 0>>
    	åç§°: _item.name x _item.count <<if _item.useCallback>><<print '<<link "ä½¿ç”¨" "ç‰©å“æ ">><<set _temp to $globalUseCallback(' + _i + ')>><</link>>'>><</if>>
        _item.desc
    <</if>>
<</for>>

<<return "è¿”å›">>


:: ç‹ä¹‹é—´ {"position":"900,1025","size":"100,100"}
(æ¸¸æˆè¿›åº¦æš‚æ—¶åªåˆ°è¿™é‡Œ)

[[å·¢ç©´æ·±å¤„]]


:: ç‹å›½æ—…è¡ŒæŒ‡å— {"position":"1000,400","size":"100,100"}
ç¿»å¼€ä¸€çœ‹ï¼Œé‡Œé¢çš„ä¹¦é¡µå…¨éƒ½è¢«æ’•æ‰äº†ï¼Œåªå‰©ä¸‹ä¸€å¼ çº¸ï¼Œä¸Šé¢æ½¦è‰åœ°å†™ç€ï¼š

<blockquote>
åœ¨å¤§æ´ªæ°´æ¥ä¸´ä¹‹å‰ï¼Œç¦»å¼€è¿™é‡Œ
<small>PS: æˆ‘æŠŠä¹¦å…¨éƒ½æ’•äº†ï¼Œå› ä¸ºä½ æ˜¯è‡ªç”±çš„</small>
</blockquote>

[[è€å¤´çš„æˆ¿é—´]]


:: ç‹éƒ½ {"position":"450,650","size":"100,100"}
ç¬¬äºŒç« â€¦â€¦
æ–½å·¥ä¸­â€¦â€¦


:: ç¥­å› {"position":"1025,1025","size":"100,100"}
(æ¸¸æˆè¿›åº¦æš‚æ—¶åªåˆ°è¿™é‡Œ)

[[å·¢ç©´æ·±å¤„]]


:: ç¦»å¼€è¿™é‡Œ {"position":"600,650","size":"100,100"}
= ç¬¬äºŒç«  =

[[ç»§ç»­->å“¥å¸ƒæ—å·¢ç©´è£‚ç¼]]

<<script>>
let G = State.variables
G.consideredInCave = false;
healing(G.me, 1.0); // å›å¤æ»¡hp
healing(G.me, -0.4); // è®¾ç½®ä¸º60%HP
addItem(G.inventory.items, G.smallHealingPotion);
G.me.weapon = G.bloodedIronSword;
G.me.armor = G.bloodedDeerskinArmor;
G.meetWallPenetrater = false //æ˜¯å¦é‡è§ç©¿å¢™è€…

<</script>>


:: ç§°å·æ  {"position":"1000,100","size":"100,100"}
<<for $i, $item range  $titles.items>>
	<<if $item.count > 0>>
    	ã€Š$item.nameã€‹<<if $item.count > 1>>x $item.count<</if>>
        $item.desc
    <</if>>
<</for>>

<<return "è¿”å›">>


:: è€å¤´çš„ä¿¡ {"position":"1000,550","size":"100,100"}
ä½ çœ‹åˆ°è¿™å°ä¿¡çš„æ—¶å€™ï¼Œæˆ‘å¤§æ¦‚å·²ç»æ­»äº†å§ã€‚
ä½ è‚¯å®šä»¥ä¸ºè¿™è€å¤´æˆ¿é—´é‡Œè—ç€ä¸å¾—äº†çš„ä¸œè¥¿ï¼Œ
ç»“æœåªå‘ç°äº†è¿™å°ä¿¡ã€‚

ä¸€å®šå¾ˆå¤±æœ›å§ã€‚
å¦‚æœæ˜¯æˆ‘çš„è¯ä¸€å®šä¼šå¾ˆå¤±æœ›ã€‚

ä¸è¿‡ä½ è‚¯å®šä¼šæƒ³ï¼šâ€œè¿™å°ä¿¡ä¸€å®šè—ç€å…³äºæˆ‘çš„èº«ä¸–çš„ä¸å¾—äº†çš„ç§˜å¯†â€ã€‚

æ˜¯çš„ï¼Œæˆ‘ä¼šå‘Šè¯‰ä½ ä¸€åˆ‡çœŸç›¸ã€‚

[[ä¸‹ä¸€é¡µ]]


:: è€å¤´çš„æˆ¿é—´ {"position":"850,425","size":"100,100"}
=è€å¤´çš„æˆ¿é—´=

<<if $oldMan.hp > 0>>
è€å¤´ï¼š ç«™ä½ã€‚è°å…è®¸ä½ éšä¾¿è¿›æˆ‘çš„æˆ¿é—´äº†ï¼Ÿ

çœ‹æ¥<span class='red'>è¦æƒ³è¿›å»è¿˜å¾—æƒ³æƒ³åŠæ³•</span>ã€‚
<<else>>
ç…é£æ™¯çš„æˆ¿é—´ã€‚
å®¶å…·å’Œæˆ‘è‡ªå·±çš„èµ·å±…å®¤å·®ä¸å¤šï¼Œä¸€å¼ åºŠï¼Œä¸€å¼ æ¡Œå­è€Œå·²ã€‚
æ¡Œå­ä¸Šæ‘†ç€[[ä¸€å°ä¿¡->è€å¤´çš„ä¿¡]]ï¼Œå’Œä¸€æœ¬ã€Š[[ç‹å›½æ—…è¡ŒæŒ‡å—]]ã€‹ã€‚
<</if>>


[[å¤§å…]]


:: èµ·å±…å®¤ {"position":"700,250","size":"100,100"}
=èµ·å±…å®¤=

ä¸€ä¸ªå°å°çš„æˆ¿é—´ï¼Œæ•´æ´ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯æ²¡æœ‰ä»€ä¹ˆç”Ÿæ´»æ°”æ¯ã€‚ 
ä¸€å¼ åºŠï¼Œä¸€å¼ æ¤…å­ï¼Œæ¡Œå­ã€‚
æ¡Œå­ä¸Šé¢æ”¾ç€[[ä¸€æœ¬ç¿»å¼€çš„ä¹¦]]ï¼Œè¿˜æœ‰èœ¡çƒ›ç‡ƒå°½ç•™ä¸‹çš„çƒ›æ³ªã€‚

<<if not $beginnerWeaponGot>>\
å¢™ä¸ŠæŒ‚ç€ä¸€æŸ„$beginnerWeapon['name']ã€‚\
<<link "è£…å¤‡" "èµ·å±…å®¤">>\
<<set $me.weapon to $beginnerWeapon>>\
<<set $beginnerWeaponGot to true>>\
<</link>>\
<<else>>\
ğŸŸ¢å¢™ä¸Šæ”¾æ­¦å™¨çš„åœ°æ–¹ç©ºç©ºå¦‚ä¹Ÿã€‚\
<</if>>\

<<if not $beginnerArmorGot>>\
å¢™ä¸ŠæŒ‚ç€ä¸€å¥—$beginnerArmor['name']ã€‚\
<<link "è£…å¤‡" "èµ·å±…å®¤">>\
<<set $me.armor to $beginnerArmor>>\
<<set $beginnerArmorGot to true>>\
<</link>>\
<<else>>\
ğŸŸ¢å¢™ä¸Šæ”¾é˜²å…·çš„åœ°æ–¹ç©ºç©ºå¦‚ä¹Ÿã€‚\
<</if>>\


[[ä¼‘æ¯]]
åˆ°[[å¤§å…]]å»ã€‚


:: StoryScript [script]
window.fightObjectCopy = function(obj){
	let resultObj = {};
	resultObj.name = obj.name;
	resultObj.hp = obj.hp;
	resultObj.max_hp = obj.max_hp;
	resultObj.resistance = obj.resistance;
	resultObj.power = obj.power;
	return resultObj;
}

window.fight = function fight(obj1, obj2, beforeFightCallbacks) {
    const calculateDamage = (attackerPower, defenderResistance) => Math.max(attackerPower - defenderResistance, 1);
    console.log('FIGHT!', obj1, obj2);
    
    let fightHistory = [];
	//å¾ªç¯è°ƒç”¨beforeFightCallbacksï¼Œæ¯ä¸ªcallbackæ¥å—obj1å’Œobj2ä½œä¸ºå‚æ•°ï¼Œæœ€åè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºè®°å½•ï¼Œå°†è¿™ä¸ªå­—ç¬¦ä¸²å­˜å…¥fightHistoryã€‚
    beforeFightCallbacks.forEach(callback => {
        // Each callback is called with obj1 and obj2 as arguments
        let result = callback(obj1, obj2);
        // Push the result into the fightHistory array
        fightHistory.push(result);
    });
	
    let { hp: hp1, power: power1, resistance: res1, name: name1 } = obj1;
    let { hp: hp2, power: power2, resistance: res2, name: name2 } = obj2;

    
    let round = 1;

    while (hp1 > 0 && hp2 > 0) {
        fightHistory.push(`å›åˆ${round}`);
        let damage = calculateDamage(power1, res2);
        hp2 = Math.max(hp2 - damage, 0);
        fightHistory.push(`${name1}å¯¹${name2}é€ æˆäº†${damage}ç‚¹ä¼¤å®³ï¼`);
        if (hp2 === 0) {
            fightHistory.push(`${name2}å€’ä¸‹äº†ï¼Œæˆ˜æ–—ç»“æŸï¼`);
            break;
        }

        damage = calculateDamage(power2, res1);
        hp1 = Math.max(hp1 - damage, 0);
        fightHistory.push(`${name2}å¯¹${name1}é€ æˆäº†${damage}ç‚¹ä¼¤å®³ï¼`);
        if (hp1 === 0) {
            fightHistory.push(`${name1}å€’ä¸‹äº†ï¼Œæˆ˜æ–—ç»“æŸï¼`);
            break;
        }

        round++;
    }

    obj1.hp = hp1;
    obj2.hp = hp2;
    return fightHistory;
}

window.dropItems = function dropItems(drops) {
    let itemList = [];

    // éå†dropsæ•°ç»„
    drops.forEach(drop => {
        // ç”Ÿæˆä¸€ä¸ªéšæœºæ•° (0-1)
        let randomChance = Math.random();
      	console.log(randomChance)
      	console.log(drop.chance)
        
        // å¦‚æœéšæœºæ•°å°äºç­‰äºæ‰è½å‡ ç‡ï¼Œåˆ™æ‰è½ç‰©å“
        if (randomChance <= drop.chance) {
            itemList.push(drop.item);
        }
    });

    return itemList; // è¿”å›æ‰è½çš„ç‰©å“åˆ—è¡¨
}

window.dropString = function dropString(droppedItems) {
    // å¦‚æœdroppedItemsä¸ºç©ºï¼Œè¿”å›æç¤ºä¿¡æ¯
    if (droppedItems.length === 0) {
        return "æ²¡æœ‰ç‰©å“æ‰è½";
    }
    
    // æå–æ¯ä¸ªç‰©å“çš„åå­—ï¼Œå¹¶ç”¨é€—å·è¿æ¥æˆå­—ç¬¦ä¸²
    let itemNames = droppedItems.map(item => item.name);
    return itemNames.join(', ');
}

window.addToInventory = function(inventory, itemList) {
    itemList.forEach(item => {
        // æ£€æŸ¥ inventory ä¸­æ˜¯å¦å·²æœ‰è¯¥ç‰©å“
        let existingItem = inventory.find(inventoryItem => inventoryItem.name === item.name);
        
        if (existingItem) {
            // å¦‚æœå·²æœ‰è¯¥ç‰©å“ï¼Œå¢åŠ  count
            existingItem.count++;
        } else {
            // å¦‚æœæ²¡æœ‰ï¼Œæ–°å¢ç‰©å“å¹¶è®¾ç½® count ä¸º 1
            inventory.push({ ...item, count: 1 });
        }
    });
}

window.checkHavingItem = function(inventory, itemName) {
    // æŸ¥æ‰¾ inventory ä¸­çš„ç‰©å“
    let item = inventory.find(inventoryItem => inventoryItem.name === itemName);
    
    // å¦‚æœç‰©å“ä¸å­˜åœ¨ï¼Œæˆ–è€… count ä¸º 0ï¼Œè¿”å› falseï¼ˆä¸æŒæœ‰ï¼‰
    if (!item || item.count === 0) {
        return false;
    }
    
    // å¦åˆ™è¿”å› trueï¼ˆæŒæœ‰ï¼‰
    return true;
}

window.getItem = function getItem(inventory, itemName) {
    // æŸ¥æ‰¾ inventory ä¸­çš„ç‰©å“
    let item = inventory.find(inventoryItem => inventoryItem.name === itemName);
    
    // å¦‚æœç‰©å“å­˜åœ¨ï¼Œè¿”å›è¯¥ç‰©å“ï¼Œå¦åˆ™è¿”å› null
    return item || null;
}

window.reduceItemCount = function reduceItemCount(inventory, itemName, count) {
    // æŸ¥æ‰¾ inventory ä¸­çš„ç‰©å“
    let item = inventory.find(inventoryItem => inventoryItem.name === itemName);
    
    if (item) {
        // å‡å°‘ç‰©å“æ•°é‡
        item.count -= count;
        
        // å¦‚æœç‰©å“æ•°é‡å°äºç­‰äº 0ï¼Œå°† count è®¾ä¸º 0
        if (item.count <= 0) {
            item.count = 0;
        }
    } else {
        console.log(`ç‰©å“ ${itemName} ä¸å­˜åœ¨äº inventory ä¸­ã€‚`);
    }
}

window.addItem = function addItem(inventory, item, count = 1) {
    // æŸ¥æ‰¾æ˜¯å¦å·²æœ‰è¯¥ç‰©å“
    let existingItem = inventory.find(inventoryItem => inventoryItem.name === item.name);
    
    if (existingItem) {
        // å¦‚æœæŒæœ‰ï¼Œæ›´æ–°ç‰©å“çš„æ•°é‡å’Œæè¿°
        existingItem.count += count;
        existingItem.desc = item.desc;  // æ›´æ–°ç‰©å“çš„æè¿°
    } else {
        // å¦‚æœä¸æŒæœ‰ï¼Œæ–°å¢ç‰©å“å¹¶è®¾ç½® count
        inventory.push({ ...item, count: count });
    }
}

window.healing = function healing(target, percentage) {
    // è®¡ç®—æ¢å¤çš„ç”Ÿå‘½å€¼
    const healAmount = target.max_hp * percentage;
    
    // å¢åŠ ç”Ÿå‘½å€¼ï¼Œä½†ä¸èƒ½è¶…è¿‡max_hp
    target.hp = Math.min(target.hp + healAmount, target.max_hp);
    
    return target.hp; // è¿”å›æ›´æ–°åçš„ç”Ÿå‘½å€¼
  
}

// å‡çº§
window.levelUp = function(target){
  	target.level += 1
  	target.intrinsicPower += 1
  	target.intrinsicResistance += 1
  	target.max_hp += 10
  	console.log(target.name + ' Level Up!')
}

window.expCurve = function expCurve(level) {
    return Math.floor(5 * Math.pow(level, 2)); // ç»éªŒå€¼éœ€æ±‚é€’å¢æ›²çº¿
}

window.expGot = function expGot(expBefore, expGot, level, levelUp) {
    let expNew = expBefore + expGot; // è®¡ç®—æ–°ç»éªŒå€¼
    let levelsGained = 0; // ç”¨äºè¿½è¸ªå‡äº†å¤šå°‘çº§

    // å¾ªç¯æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡çº§
    while (expNew >= expCurve(level)) {
        expNew -= expCurve(level); // å‡å»å½“å‰çº§åˆ«çš„ç»éªŒéœ€æ±‚
        level += 1; // å‡ä¸€çº§
        levelsGained += 1; // è®°å½•å‡ä¸€çº§
        levelUp(); // è°ƒç”¨levelUpå‡½æ•°
    }

    return { newExp: expNew, newLevel: level, levelsGained: levelsGained };
}

:: StoryStylesheet [stylesheet]
.danger{
	color: red;
}
.good{
	color: #90EE90;
}
.important{
  	color: orange;
}
.red{
	color: red;
}